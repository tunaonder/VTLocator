<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"   
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:p="http://primefaces.org/ui"
      xmlns:f="http://xmlns.jcp.org/jsf/core">

    <h:body>
        <!-- Do not enter tags before the composition line since they are ignored by JSF -->

        <!-- This page is constructed based on the siteTemplate -->
        <ui:composition template="template/siteTemplate.xhtml">

            <ui:define name="header" >
                <p:growl></p:growl>
                <nav class=" navbar-default navbar-fixed-top">
                    <div class="container-fluid navbar-bottom">
                        <h:form>
                            <div class="navbar-header">
                            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                                <span class="sr-only">Toggle navigation</span>
                                <span class="icon-bar"></span>
                                <span class="icon-bar"></span>
                                <span class="icon-bar"></span>
                            </button>
                            <h:commandLink class="navbar-brand" action="#{buildingManager.reInit4()}">
                                <img class="logo logo-header logo-center" src="resources/images/logo_primary.png"/>
                            </h:commandLink>
                        </div>
                            
                        </h:form>
                        

                        <div class="navbar-collapse collapse">
                            <h:form>
                                <h:panelGroup layout="block" rendered="#{profileViewManager.loggedInUser != null}">
                                    <ul class="nav navbar-nav navbar-right">
                                        <li><h:link outcome="buildings">Buildings &amp; Parking</h:link></li>
                                        <li><h:commandLink action="#{buildingManager.reInit2()}">Lost &amp; Found</h:commandLink></li>
                                        <li class="user-dropdown">
                                            <div class="btn-group">
                                                <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                                    <i class="fa fa-angle-down pull-right"></i>
                                                    <img class="user-profile-img" src="FileStorageLocation/#{accountManager.userPhoto()}"/>
                                                    <span>Hi, #{profileViewManager.loggedInUser.firstName}!</span>
                                                </button>
                                                <ul class="dropdown-menu">
                                                    <li><h:commandLink action="#{buildingManager.reInit3()}"><i class="fa fa-user fa-fw"></i> Your Profile</h:commandLink></li>
                                                    <li role="separator" class="divider"></li>
                                                    <li><h:commandLink action="#{accountManager.logout()}" > <i class="fa fa-sign-out fa-fw"></i> Logout</h:commandLink></li>
                                                </ul>
                                            </div>
                                        </li>
                                    </ul>
                                </h:panelGroup>
                                <h:panelGroup layout="block" rendered="#{profileViewManager.loggedInUser == null}">
                                    <ul class="nav navbar-nav navbar-right">
                                        <li><h:button id="login"  value="Login" outcome="login" styleClass="btn btn-default btn-nav"/></li>
                                        <li><h:button id="signup"  value="Sign Up" outcome="signup" styleClass="btn btn-default btn-nav"/></li>
                                    </ul>
                                </h:panelGroup>


                            </h:form>

                        </div>
                    </div>
                </nav>

            </ui:define>

            <ui:define name="sidebar">

                <h:form>
                    <ul class="nav nav-tabs nav-justified">
                        <li role="presentation"  class="active"><h:link outcome="buildings">Buildings</h:link></li>
                        <li role="presentation"><h:commandLink action="#{buildingManager.reInit()}">Parking</h:commandLink></li>
                    </ul>

                </h:form>



                <h:form id="dropDownForm">
                    <!--                    Initial DropDown Menu, Thats why it is rendered if direction button is not pressed yet-->
                    <div class="dropdown" >
                        <p:selectOneMenu id="buildingNamesDropDown" value="#{buildingManager.selectedBuildingName}" styleClass="dropMenu" rendered="#{buildingManager.directionPressed == false}" >
                            <!--                            Display Building Location and Update the value of selected building-->
                            <p:ajax  oncomplete="displayBuilding()" update="address buildingLat buildingLong buildingImage buildingDescription getDirection buildingCategoryDropDown selectCategoryButton" />
                            <p:ajax listener="#{buildingManager.displayBuildingInformation}" />
                            <p:ajax listener="#{buildingManager.changeDirectionAvailableStatus()}" />
                            <f:selectItem itemLabel="Select Building" itemValue="" noSelectionOption="true" />
                            <!--                            Building Names is returned from Restful Service-->
                            <f:selectItems value="#{buildingManager.buildingNamesJSON}"  />

                        </p:selectOneMenu>
                        <p:commandButton id="getDirection"  value="Get Directions" disabled="#{buildingManager.directionAvailable == false}"
                                         styleClass="btn btn-default btn-direction" rendered="#{buildingManager.directionPressed == false}">
                            <p:ajax listener="#{buildingManager.directionButtonPressed()}" update="dropDownForm dropDownForm:destinationDropdown dropDownForm:buildingDescription dropDownForm:buildingImage" />

                        </p:commandButton>


                        <p:selectOneMenu id="buildingCategoryDropDown" value="#{buildingManager.buildingCategory}" styleClass="dropMenu"  rendered="#{buildingManager.directionPressed == false}">
                            <f:selectItem itemLabel="Select Category" itemValue="" noSelectionOption="true" />
                            <!--                            Building Categories are returned from Restful Service-->
                            <f:selectItems value="#{buildingManager.buildingCategoriesJSON}"  />
                            <p:ajax listener="#{buildingManager.searchByCategory}" update="getDirection buildingNamesDropDown buildingDescription buildingImage" />
                            <p:ajax listener="#{buildingManager.changeCategoryAvailableStatus()}" update="selectCategoryButton"/>
                            <p:ajax oncomplete="resetMarker()" />
                            <p:ajax update="dropDownForm:jsonResult"/>

                        </p:selectOneMenu>
                        <p:commandButton id="selectCategoryButton" value = "Display Buildings"  styleClass="btn btn-default btn-direction" 
                                         rendered="#{buildingManager.directionPressed == false}" disabled="#{buildingManager.categoryAvailable == false}" >
                            <p:ajax oncomplete="displayBuildingLocations()"/>
                        </p:commandButton> 

                    </div>
                    <!--                        Get The Value Of Building Name To An Hidden Input-->
                    <h:inputHidden id="address" value="#{buildingManager.selectedBuildingName}"/>
                    <!--                    Latitude and Longitude of currently selected building-->
                    <h:inputHidden id="buildingLat" value="#{buildingManager.lat}" />
                    <h:inputHidden id="buildingLong" value="#{buildingManager.lng}" />
                    <h:inputHidden id="jsonResult" value="#{buildingManager.jsonCategory}" />



                    <div align="center">





                        <h:panelGrid  rendered="#{buildingManager.directionPressed == true}" columns="2" columnClasses="building-label, login-input">

                            <h:outputLabel styleClass="outputLabel"  value="From: " />
                            <!--                        This Dropdown Menu is displayed after Direction Button Pressed-->
                            <ul class="dropdown" >
                                <p:selectOneMenu id="startDropdown" value="#{buildingManager.selectedStartPoint}" styleClass="dropMenu" rendered="#{buildingManager.directionPressed == true}">
                                    <p:ajax listener="#{buildingManager.createStartPoint}" />
                                    <!--                                Calls Java Script Method which draws the Route-->
                                    <p:ajax oncomplete="drawRoute()" update="startBuildingLat startBuildingLong" />
                                    <f:selectItem itemLabel="Select Building" itemValue="" noSelectionOption="true" />
                                    <f:selectItems value="#{buildingManager.buildingNamesJSON}"  />
                                </p:selectOneMenu>                       


                            </ul>


                            <h:outputLabel styleClass="outputLabel" value="To: " />
                            <ul class="dropdown" >
                                <p:selectOneMenu id="destinationDropdown" value="#{buildingManager.selectedBuildingName}" styleClass="dropMenu"  rendered="#{buildingManager.directionPressed == true}">
                                    <p:ajax listener="#{buildingManager.createDestinationPoint}" />
                                    <!--                                Calls Java Script Method which draws the Route-->
                                    <p:ajax oncomplete="drawRoute()" update="buildingLat buildingLong distanceValue durationValue" />
                                    <f:selectItems value="#{buildingManager.buildingNamesJSON}"  />
                                </p:selectOneMenu>
                            </ul>
                            


                        </h:panelGrid>
                        <h:panelGrid rendered="#{buildingManager.directionPressed == true}" width="280px" columns="2">
                            <h:outputLabel styleClass="outputLabel" value="Distance: " /> <h:outputLabel id="distanceValue" styleClass="outputLabel" value="0" />
                            <h:outputLabel styleClass="outputLabel" value="Duration: " /> <h:outputLabel id="durationValue" styleClass="outputLabel" value="0" />
                            
                        </h:panelGrid>
                        
                        <h:inputHidden id="startBuildingLat" value="#{buildingManager.lat2}" />
                        <h:inputHidden id="startBuildingLong" value="#{buildingManager.lng2}" />

                        <!--                        Resets the Page to its initial state-->
                        <p:commandButton  value="Refresh" onclick="refreshMap()"
                                          styleClass="btn btn-default btn-direction">
                            <p:ajax listener="#{buildingManager.init()}" update="dropDownForm"/>

                        </p:commandButton>

                    </div>

                    <!--                    Building Description and Image Is Displayed-->
                    <ul class="buildingInfo" >
                        <p:inputTextarea id="buildingDescription" rows="8" cols="31" styleClass="buildingDescription" 
                                         value="#{buildingManager.description}" rendered="#{buildingManager.directionPressed == false}"/>

                        <h:graphicImage id="buildingImage" url="#{buildingManager.imageUrl}" styleClass="buildingImage" rendered="#{buildingManager.directionPressed == false}"/>

                    </ul>

                </h:form>



            </ui:define>

            <ui:define  name="mainPanel" >
                <p:growl id="messages" showDetail="true" />

                <div id="map" style="width:100%; height:100%;"></div>


                <script type="text/javascript" >
                    initilaizeMap();

                </script>


            </ui:define>

        </ui:composition>
        <!-- Do not enter tags after the composition line since they are ignored by JSF -->
    </h:body>

</html>
