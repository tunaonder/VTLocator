<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"   
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:p="http://primefaces.org/ui"
      xmlns:f="http://xmlns.jcp.org/jsf/core">

    <h:body>
        <!-- Do not enter tags before the composition line since they are ignored by JSF -->

        <!-- This page is constructed based on the siteTemplate -->
        <ui:composition template="template/siteTemplate.xhtml">

            <ui:define name="sidebar">
                
           

                <h:form id="dropDownForm" >
                    
                    
                    
                    <!--                    Initial DropDown Menu, Thats why it is rendered if direction button is not pressed yet-->
                    <div class="dropdown" >
                        
                        <ul class="nav nav-tabs nav-justified">
                    <li role="presentation" class="active">
                        <h:commandLink action="#{buildingManager.reInit()}" onclick="refreshMap()" >Buildings
                            <p:ajax listener="#{buildingManager.init()}" update="dropDownForm"/>
                        </h:commandLink>
                    </li>
                    <li role="presentation"><h:link outcome="parking">Parking</h:link></li>
                </ul>
                        <p:selectOneMenu value="#{buildingManager.selectedBuildingName}" styleClass="dropMenu" rendered="#{buildingManager.directionPressed == false}" >
                            <!--                            Display Building Location and Update the value of selected building-->
                            <p:ajax  oncomplete="displayBuilding()" update="address buildingLat buildingLong buildingImage buildingDescription getDirection buildingCategoryDropDown" />
                            <p:ajax listener="#{buildingManager.displayBuildingInformation}" />
                            <p:ajax listener="#{buildingManager.changeDirectionAvailableStatus()}" />
                            <f:selectItem itemLabel="Select Building" itemValue="" noSelectionOption="true" />
                            <!--                            Building Names is returned from Restful Service-->
                            <f:selectItems value="#{buildingManager.buildingNamesJSON}"  />

                        </p:selectOneMenu>
                        <p:commandButton id="getDirection"  value="Get Directions" disabled="#{buildingManager.directionAvailable == false}"
                                         styleClass="btn btn-default btn-direction" rendered="#{buildingManager.directionPressed == false}">
                            <p:ajax listener="#{buildingManager.directionButtonPressed()}" update="dropDownForm dropDownForm:destinationDropdown dropDownForm:buildingDescription dropDownForm:buildingImage" />

                        </p:commandButton>


                        <p:selectOneMenu id="buildingCategoryDropDown" value="#{buildingManager.buildingCategory}" styleClass="dropMenu"  rendered="#{buildingManager.directionPressed == false}">
                            <f:selectItem itemLabel="Select Category" itemValue="" noSelectionOption="true" />
                            <!--                            Building Categories are returned from Restful Service-->
                            <f:selectItems value="#{buildingManager.buildingCategoriesJSON}"  />
                            <p:ajax listener="#{buildingManager.searchByCategory}" />
                            <p:ajax update="dropDownForm:jsonResult"/>

                        </p:selectOneMenu>
                        <p:commandButton value = "Display Buildings"  styleClass="btn btn-default btn-direction" 
                                         rendered="#{buildingManager.directionPressed == false}" >
                            <p:ajax oncomplete="displayBuildingLocations()"/>
                        </p:commandButton> 

                    </div>
                    <!--                        Get The Value Of Building Name To An Hidden Input-->
                    <h:inputHidden id="address" value="#{buildingManager.selectedBuildingName}"/>
                    <!--                    Latitude and Longitude of currently selected building-->
                    <h:inputHidden id="buildingLat" value="#{buildingManager.lat}" />
                    <h:inputHidden id="buildingLong" value="#{buildingManager.lng}" />
                    <h:inputHidden id="jsonResult" value="#{buildingManager.jsonCategory}" />



                    <div align="center">





                        <h:panelGrid  rendered="#{buildingManager.directionPressed == true}" columns="2" columnClasses="building-label, login-input">

                            <h:outputLabel styleClass="outputLabel"  value="From: " />
                            <!--                        This Dropdown Menu is displayed after Direction Button Pressed-->
                            <ul class="dropdown" >
                                <p:selectOneMenu id="startDropdown" value="#{buildingManager.selectedStartPoint}" styleClass="dropMenu" rendered="#{buildingManager.directionPressed == true}">
                                    <p:ajax listener="#{buildingManager.createStartPoint}" />
                                    <!--                                Calls Java Script Method which draws the Route-->
                                    <p:ajax oncomplete="drawRoute()" update="startBuildingLat startBuildingLong" />
                                    <f:selectItem itemLabel="Select Building" itemValue="" noSelectionOption="true" />
                                    <f:selectItems value="#{buildingManager.buildingNamesJSON}"  />
                                </p:selectOneMenu>                       


                            </ul>


                            <h:outputLabel styleClass="outputLabel" value="To: " />
                            <ul class="dropdown" >
                                <p:selectOneMenu id="destinationDropdown" value="#{buildingManager.selectedBuildingName}" styleClass="dropMenu"  rendered="#{buildingManager.directionPressed == true}">
                                    <p:ajax listener="#{buildingManager.createDestinationPoint}" />
                                    <!--                                Calls Java Script Method which draws the Route-->
                                    <p:ajax oncomplete="drawRoute()" update="buildingLat buildingLong" />
                                    <f:selectItems value="#{buildingManager.buildingNamesJSON}"  />
                                </p:selectOneMenu>
                            </ul>



                        </h:panelGrid>
                        <h:inputHidden id="startBuildingLat" value="#{buildingManager.lat2}" />
                        <h:inputHidden id="startBuildingLong" value="#{buildingManager.lng2}" />

                        <!--                        Resets the Page to its initial state-->
                        <p:commandButton  value="Refresh" onclick="refreshMap()"
                                          styleClass="btn btn-default btn-direction">
                            <p:ajax listener="#{buildingManager.init()}" update="dropDownForm"/>

                        </p:commandButton>

                    </div>

                    <!--                    Building Description and Image Is Displayed-->
                    <ul class="buildingInfo" >
                        <p:inputTextarea id="buildingDescription" rows="8" cols="31" styleClass="buildingDescription" 
                                         value="#{buildingManager.description}" rendered="#{buildingManager.directionPressed == false}"/>

                        <h:graphicImage id="buildingImage" url="#{buildingManager.imageUrl}" styleClass="buildingImage" rendered="#{buildingManager.directionPressed == false}"/>

                    </ul>

                </h:form>



            </ui:define>

            <ui:define  name="mainPanel" >
                <p:growl id="messages" showDetail="true" />

                <div id="map" style="width:100%; height:100%;"></div>


                <script type="text/javascript" >
                   initilaizeMap();
                   
                </script>


            </ui:define>

        </ui:composition>
        <!-- Do not enter tags after the composition line since they are ignored by JSF -->
    </h:body>

</html>
