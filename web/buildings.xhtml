<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:p="http://primefaces.org/ui"
      xmlns:f="http://xmlns.jcp.org/jsf/core"         
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      >

    <h:body>
        <!-- Do not enter tags before the composition line since they are ignored by JSF -->

        <!-- This page is constructed based on the siteTemplate -->
        <ui:composition template="template/siteTemplate.xhtml">




            <ui:define name="sidebar">



                <h:form>
                    <ul class="nav nav-tabs nav-justified categories-nav">
                        <li role="presentation"  class="active"><h:link outcome="buildings">Buildings</h:link></li>
                        <li role="presentation"><h:link outcome="parking">Parking</h:link></li>
                    </ul>

                </h:form>


                <h:form id="dropDownForm">
                    <!--Initial DropDown Menu, Thats why it is rendered if direction button is not pressed yet-->
                    <div class="dropdown" >
                        <p:selectOneMenu id="buildingNamesDropDown" value="#{buildingManager.selectedBuildingName}" styleClass="dropMenu" rendered="#{buildingManager.directionPressed == false}" >
                            <!--                            Display Building Location and Update the value of selected building-->
                            <p:ajax  oncomplete="displayBuilding()" update="address buildingLat buildingLong buildingImage buildingDescription getDirection buildingCategoryDropDown selectCategoryButton" />
                            <p:ajax listener="#{buildingManager.displayBuildingInformation}" />
                            <p:ajax listener="#{buildingManager.changeDirectionAvailableStatus()}" />
                            <f:selectItem itemLabel="Select Building" itemValue="" noSelectionOption="true" />
                            <!--                            Building Names is returned from Restful Service-->
                            <f:selectItems value="#{buildingManager.buildingNamesJSON}"  />

                        </p:selectOneMenu>
                        <p:commandButton id="getDirection"  value="Get Directions" disabled="#{buildingManager.directionAvailable == false}"
                                         styleClass="btn btn-default btn-direction" rendered="#{buildingManager.directionPressed == false}">
                            <p:ajax listener="#{buildingManager.directionButtonPressed()}" update="dropDownForm dropDownForm:destinationDropdown dropDownForm:buildingDescription dropDownForm:buildingImage" />

                        </p:commandButton>


                        <p:selectOneMenu id="buildingCategoryDropDown" value="#{buildingManager.buildingCategory}" styleClass="dropMenu"  rendered="#{buildingManager.directionPressed == false}">
                            <f:selectItem itemLabel="Select Category" itemValue="" noSelectionOption="true" />
                            <!--                            Building Categories are returned from Restful Service-->
                            <f:selectItems value="#{buildingManager.buildingCategoriesJSON}"  />
                            <p:ajax listener="#{buildingManager.searchByCategory}" update="getDirection buildingNamesDropDown buildingDescription buildingImage" />
                            <p:ajax listener="#{buildingManager.changeCategoryAvailableStatus()}" update="selectCategoryButton"/>
                            <p:ajax oncomplete="resetMarker()" />
                            <p:ajax update="dropDownForm:jsonResult"/>

                        </p:selectOneMenu>
                        <p:commandButton id="selectCategoryButton" value = "Display Buildings"  styleClass="btn btn-default btn-direction" 
                                         rendered="#{buildingManager.directionPressed == false}" disabled="#{buildingManager.categoryAvailable == false}" >
                            <p:ajax oncomplete="displayBuildingLocations()"/>
                        </p:commandButton> 

                    </div>
                    <!--                        Get The Value Of Building Name To An Hidden Input-->
                    <h:inputHidden id="address" value="#{buildingManager.selectedBuildingName}"/>
                    <!--                    Latitude and Longitude of currently selected building-->
                    <h:inputHidden id="buildingLat" value="#{buildingManager.lat}" />
                    <h:inputHidden id="buildingLong" value="#{buildingManager.lng}" />
                    <h:inputHidden id="jsonResult" value="#{buildingManager.jsonCategory}" />



                    <div align="center">


                        <h:panelGrid  rendered="#{buildingManager.directionPressed == true}" columns="2" columnClasses="building-label, login-input">

                            <h:outputLabel styleClass="outputLabel"  value="From: " />
                            <!--                        This Dropdown Menu is displayed after Direction Button Pressed-->
                            <ul class="dropdown" >
                                <p:selectOneMenu id="startDropdown" value="#{buildingManager.selectedStartPoint}" styleClass="dropMenu" rendered="#{buildingManager.directionPressed == true}">
                                    <p:ajax listener="#{buildingManager.createStartPoint}" />
                                    <!--                                Calls Java Script Method which draws the Route-->
                                    <p:ajax oncomplete="drawRoute()" update="startBuildingLat startBuildingLong" />
                                    <f:selectItem itemLabel="Select Building" itemValue="" noSelectionOption="true" />
                                    <f:selectItems value="#{buildingManager.buildingNamesJSON}"  />
                                </p:selectOneMenu>                       


                            </ul>


                            <h:outputLabel styleClass="outputLabel" value="To: " />
                            <ul class="dropdown" >
                                <p:selectOneMenu id="destinationDropdown" value="#{buildingManager.selectedBuildingName}" styleClass="dropMenu"  rendered="#{buildingManager.directionPressed == true}">
                                    <p:ajax listener="#{buildingManager.createDestinationPoint}" />
                                    <!--                                Calls Java Script Method which draws the Route-->
                                    <p:ajax oncomplete="drawRoute()" update="buildingLat buildingLong distanceValue durationValue" />
                                    <f:selectItems value="#{buildingManager.buildingNamesJSON}"  />
                                </p:selectOneMenu>
                            </ul>



                        </h:panelGrid>
                        <h:panelGrid rendered="#{buildingManager.directionPressed == true}" width="280px" columns="2">
                            <h:outputLabel styleClass="outputLabel" value="Distance: " /> <h:outputLabel id="distanceValue" styleClass="outputLabel" value="0" />
                            <h:outputLabel styleClass="outputLabel" value="Duration: " /> <h:outputLabel id="durationValue" styleClass="outputLabel" value="0" />

                        </h:panelGrid>

                        <h:inputHidden id="startBuildingLat" value="#{buildingManager.lat2}" />
                        <h:inputHidden id="startBuildingLong" value="#{buildingManager.lng2}" />

                        <!--                        Resets the Page to its initial state-->
                        <h:commandButton id="refreshButton" value="Refresh" onclick="refreshMap()"
                                         styleClass="btn btn-default btn-direction buildings-refresh-button" action="#{buildingManager.setInitialValues()}">
                            <p:ajax update="dropDownForm"/>

                        </h:commandButton>

                    </div>

                                        <!--                    Building Description and Image Is Displayed-->
                    <div class="buildingInfo" >
                        <p:outputLabel id="buildingDescription" styleClass="buildingDescription" 
                                       value="#{buildingManager.description}" rendered="#{buildingManager.directionPressed == false}"/>

                        <h:graphicImage id="buildingImage" url="#{buildingManager.imageUrl}" styleClass="buildingImage" rendered="#{buildingManager.directionPressed == false}"/>
                    </div>
                    

          
                </h:form>

            </ui:define>


            <ui:define  name="mainPanel" >
                <p:growl id="messages" showDetail="true" />

                <div id="map" style="width:100%; height:100%;"></div>

                <script type="text/javascript" >

                     
                    initilaizeMap();

                    window.addEventListener("beforeunload", function(e){
                            $(".buildings-refresh-button").click();
                    }, false);


                </script>




            </ui:define>


        </ui:composition>
        <!-- Do not enter tags after the composition line since they are ignored by JSF -->
    </h:body>

</html>
